const o={START_TIMER:"start-timer",STEP_TIMER:"step-timer",END_TIMER:"end-timer"},t={WORK_TIMER:"work-timer",BREAK_TIMER:"break-timer"};let i=25;function a(e){i=e,localStorage.setItem("workDuration",e)}let l=3;function r(e){l=e,localStorage.setItem("workTimes",e)}let c=5;function u(e){c=e,localStorage.setItem("breakDuration",e)}let e=null,s=null,n=null,d=0,m=null,g=0,f=null,E=null,y=[],I=null,R=null,T=null,k=null;async function P(){for(W(),e=l,_();0!==e;)--e,await p(t.WORK_TIMER),I.play(),new Notification("Time to have a break!"),0!==e&&(await p(t.BREAK_TIMER),I.play(),0===e?new Notification("Good job, you finished your pomodoro!"):new Notification("Let's get back to work."))}function $(){w(),v(),h(),b()}async function p(n){let e=0;switch(n){case t.WORK_TIMER:e=60*i;break;case t.BREAK_TIMER:e=60*c}return new Promise(t=>{(k=new Worker("timerWorker.js")).postMessage({action:o.START_TIMER,timerSeconds:e}),k.onmessage=e=>{switch(e.data.action){case o.STEP_TIMER:M(),B(n);break;case o.END_TIMER:v(),w(),t()}}})}function w(){k&&(k.terminate(),k=null)}function M(e=null){d=null!=e?0:(d+6)%360,n.style.transform=`rotate(${d}deg)`}function v(){M(0)}function _(){var t=2*l-1,e=i*l+c*(l-1),n=360*i/e,o=360*c/e;f=n/(60*i),E=o/(60*c);let a=n;for(let e=0;e<t;e+=1)y[e]=document.createElement("div"),y[e].className="analog-timer-phase-separator",y[e].style.transform=`rotate(${a}deg)`,s.appendChild(y[e]),e%2==0?a+=o:a+=n}function b(){y.forEach(e=>{e.remove()}),y=[]}function B(e){switch(e){case t.WORK_TIMER:g+=f;break;case t.BREAK_TIMER:g+=E}m.style.background=`conic-gradient(var(--soft-grey), ${g}deg, transparent ${g}deg 360deg)`}function h(){g=0,f=null,E=null,m.style.background="conic-gradient(var(--soft-grey), 0deg, transparent 0deg 360deg)"}function L(){R.style.display="none",T.style.display="flex"}function j(){R.style.display="block",T.style.display="none"}function S(){var e=localStorage.getItem("workDuration"),e=(e&&(i=e),localStorage.getItem("workTimes")),e=(e&&(l=e),localStorage.getItem("breakDuration"));e&&(c=e)}function N(){const e=document.getElementById("work-duration-input"),t=(e.value=i,e.onchange=e=>{a(e.target.value)},document.getElementById("work-times-input")),n=(t.value=l,t.onchange=e=>{r(e.target.value)},document.getElementById("break-duration-input"));n.value=c,n.onchange=e=>{u(e.target.value)}}function K(){s=document.getElementById("analog-timer-circle"),n=document.getElementById("analog-timer-needle"),m=document.getElementById("analog-timer-completion")}function A(){R=document.getElementById("settings-dialog-content"),T=document.getElementById("settings-dialog-closed-content")}function D(){(I=new Audio("./ding.mp3")).volume=.5}function W(){"granted"!==Notification.permission&&"default"===Notification.permission&&Notification.requestPermission()}function O(){S(),N(),K(),A(),D()}document.addEventListener("DOMContentLoaded",O,!1);